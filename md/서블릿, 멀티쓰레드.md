# MVC(1)

### 정적 페이지 / 동적 페이지

**정적 페이지** : 

서버는 클라이언트의 요청에 따라 변화가 없는 정해진 페이지를 반환하는 역할

**동적 페이지** : 

검색 (포털 사이트를 통해),(특정 사이트) 로그인, 결제서비스  ⇒ 동적 웹 서비스

동적 웹 서비스 구현한 동적 웹사이트(클라이언트 요청 발생에 따라 변화하는 페이지)

### 웹 서버와 웹 애플리케이션 서버

서버 : 웹서버 /  웹 애플리케이션 서버로 구분
(ex) 웹서버 : Apache Server / 웹 애플리케이션 서버 : Tomcat

클라이언트 : 서버에 서비스를 요청하고 (요청한)서비스를 서버로부터 제공받는 쪽

```markdown
   |Client|               |WebServer|              |AppServer|          |Database|
          -> |HTTP 요청| ->
															-> |비즈니스 로직 처리 요청| -> 
                                                           -> |데이터 조회 요청| ->
                                                           <- |데이터 응답| <-
                             <-  |처리된 응답|  <-
         <-  |최종 응답|  <-                     
```

*정적 페이지 : 웹서버는 정적인 콘텐츠만 저장하고 있기에, 클라이언트로부터 정적 페이지 요청이 들어오면 웹 서버는 웹 애플리케이션 서버 에 위임하지 않고, 웹서버에서 응답하여 응답된 결과를 클라이언트에게 보냄

*동적 페이지: 클라이언트로부터 동적 페이지 요청이 들어오면 해당 요청을 웹 애플리케이션 서버에 위임하여 (위임하는 역할: 웹서버) 웹 애플리케이션 서버에서 처리

### ASP / PHP / JSP

- ASP (Active Server Page) 
: 윈도우의 IIS 웹 서버에서 실행될 수 있는 웹 프로그래밍 언어 (현재는 많이 안쓰임)
- PHP(Hypertext Preprocessor)
: C를 기반으로 만들어진 웹 프로그래밍 언어로 빠른 실행 속도와 배우기 쉽다는 장점이 있음
- JSP(Java Server Page)
: Java 기반으로 만들어 졌으며 컴파일 이후 서블릿으로 변환되어 서버에서 동적으로 작동
(서블릿 (Servlet) : 클라이언트의 요청을 처리하고, 그 결과를 반환하는 Servlet 클래스의 구현 규칙을
 지킨 자바 웹 프로그래밍 기술 즉  동적인 페이지를 제공할 수있도록 하는것)
### 서블릿

```html
<form action="/save" method="post">
	<input type="text" name="username" />
	<input type="text" name="age" />
	<button type="submit">전송 </button>
</form>
(Submit)
username: kim / age: 20 
```

`[ WebBrowser가 생성한 Request HTTP Message ]`

```markdown
POST /save HTTP/1.1
Host:localhost:8080
Content-Type:application/x-www-form-urlencoded
username=kim&age=20
```

Server TCP / IP Connect 대기 , 소켓 연결 → HTTP 요청 메시지를 파싱해서 읽기 , POST방식인지 인지 

→`Content-Type:application/x-www-form-urlencoded` (ConnecctType 파악)

→Username , Age 와 같은 바디 내용을 파싱 (-데이터를 사용할 수있게하기위해서)

→저장 프로세스 실행

**→ 비즈니스 로직 실행 (데이터베이스와의 상호작용) (의미있는 비즈니스로직)**

→요청에 대한 응답 메시지 생성

```markdown
HTTP/1.1 200 OK
Content-Type:text/html;charset=UTF-8
Content-Length:3423
<html>
<body>..</body>
</html>
```

---

**이 위에 있는 과정을 수행하고, 자동화하는게 서블릿**

### 서블릿의 특징

- HTTP 요청이 서버로 전송되면, 서블릿이 이 요청을 받아 처리
    - HTTP 요청 정보를 편리하게 사용할 수 있는 HttpServletRequest
    - HTTP 응답 정보를 편리하게 제공할 수 있는 HttpServletResponse
- URL 패턴(urlPatterns)을 통해 특정 URL에 대한 요청이 서블릿 코드로 연결

```java
@WebServlet(name="helloServlet", urlPatterns="/hello")
public class HelloServlet extends HttpServlet {
       @Override
       //HTTP 요청정보 파싱(HttpServletRequest), 응답메시지 생성(HttpServletResp
       protected void service(HttpServletRequest request, HttpServletResponse response) {
         //Application 로직
       }
   }
```

### 서블릿 컨테이너

- Tomcat 처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 함.
- 서블릿  컨테이너는 서블릿 객체를 생성, 초기화 , 호출, 종료하는 생명주기를 관리
- 서블릿 객체는 싱글톤으로 관리한다.
    - 싱글톤으로 관리한다는것은, 객체를 하나를 만들어놓고 공유해서 사용하는것을 싱글톤을로 관리한다고 한다.
    - 즉, 고객의 요청이 올때마다 계속 객체를 생성하는 것은 비 효율적이다. 최초 로딩 시점에 서블릿 객체를 미리 만들어두고 이를 공유해서 사용하는 것.
    - 공유 변수를 사용 주의
        - 서블릿 객체는 싱글톤을 관리된다는게, 하나의 서블릿 인스턴스를 여러 요청이 동시에 공유하게 됨.
        한 사용자가 인스턴스 변수를 선언하면 모든 요청이 이 인스턴스 변수를 공유하게 되는데 이 과정에서 데이터의 일관성이 깨지는 등 동시성 문제가 발생할 수도 있음. 
        그래서 공유 변수를 사용시 주의해야하는건데. 로컬변수를 사용하거나(doGet, doPost etc..)
        synchronized 블록을 사용, ThreadLocal를 사용해서 안전하게 사용할 수 있음.
    - 서블릿 컨테이너 종료시 함께 종료 
    (ex) Tomcat 서버가 시스템이 실행될 때, 동작되는거, 종료되면 서버가 종료되는것 
    서블릿 컨테이너가(Tomcat) 종료시 함께 서블릿도 함께 종료되고 관련된 모든 리소스와의 연결이 해제
    
- JSP도 서블릿으로 변환 되어서 사용
- 동시 요청을 위한 멀티 쓰레드 처리 지원.